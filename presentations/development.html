<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>VIC - On Development</title>

		<meta name="description" content="VIC&trade; is a compiler for Microchip PIC microcontrollers">
		<meta name="author" content="Vikas N Kumar">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">
            <noscript>This presentation is best viewed with Javascript enabled on a
            modern browser supporting HTML5 like the latest versions of Mozilla Firefox, Google Chrome,
            Apple Safari or Microsoft Internet Explorer.</noscript>

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
                <section>
					<h1>VIC&trade;</h1>
                    <h3>Developing the compiler</h3>
					<p>
						<small>Created by <a
                                href="https://twitter.com/_vicash_">Vikas N Kumar</a> / <a href="http://selectiveintellect.com">Selective Intellect</a></small>
                    </p><p>
						<small>Follow us on Twitter at <a
                                href="https://twitter.com/_vicash_">@_vicash_</a> / <a
                                href="https://twitter.com/selectintellect">@selectintellect</a></small>
                    </p>
                    <p><small>&copy; 2014. Selective Intellect LLC. All Rights Reserved.</small>
				</section>

				<section data-autoslide="5000">
					<h2>What is needed ?</h2>
                    <ul>
                        <li>Perl &gt;= 5.8.8 </li>
                        <li><code style="color:yellow;">Pegex</code> for grammar parsing</li>
                        <li><code style="color:yellow;">Moo</code> for backend code generation management</li>
                        <li><code style="color:yellow;">Alien::gputils</code> for assembly compiling to
                        <code style="color:yellow;">.hex</code></li>
                        <li><code style="color:yellow;">gpsim</code> for Simulation</li>
                    </ul>
				</section>
                <section>
                    <h2>Parsing Expression Grammars</h2>
                    <ul>
                        <li><a
                            href="https://en.wikipedia.org/wiki/Parsing_expression_grammar"
                            >Created in 2004 by Bryan Ford</a>
                        </li>
                        <li>Formal language defined as rules</li>
                        <li>Each rule is a collection of <em>atoms</em></li>
                        <li>Each <em>atom</em> is a regular expression</li>
                        <li>Looks like Context Free Grammar but
                        isn't</li>
                        <li>Recursive Descent Parser: first match is used</li>
                    </ul>
                </section>
                <section>
                    <h2>Writing Grammar Using Pegex</h2>
                    <ul>
                        <li>Created by Ingy, inspired by Perl6</li>
                        <li>
                        <code style="color:yellow;">Pegex::Grammar</code> sub-class generated by
                        <code style="color:yellow;">Pegex::Parser</code>
                        </li>
                        <li>
                        Grammar can be a string constant or a file to be parsed
                        </li>
                        <li>Grammar compiled only once by developer</li>
                        <li>Grammar compiled into <code style="color:yellow;">VIC::Grammar</code></li>
                    </ul>
                </section>
                <section>
                    <h2>What about Abstract Syntax Tree ?</h2>
                    <ul>
                        <li><code style="color:yellow;">Pegex::Parser</code> invokes abstract class
                        <code style="color:yellow;">Pegex::Receiver</code></li>
                        <li>User creates derived class
                        <code style="color:yellow;">VIC::Receiver</code></li>
                        <li>On each rule callback <code style="color:yellow;">got_$RULE</code>
                        invoked</li>
                        <li>Each of these callbacks are optional</code>
                        <li>User has to define callback <code style="color:yellow;">final</code></li>
                    </ul>
                </section>
                <section>
                    <h2>... Abstract Syntax Tree ...</h2>
                    <ul>
                        <li>Arguments to callbacks can be arrays of parsed tokens</li>
                        <li>In the user's callbacks, user can handle each token</li>
                        <li>Tokens not handled are returned in the parent
                        rules</li>
                        <li>AST is created by user in the sub-class</li>
                        <li>In our case, AST is a hash in <code style="color:yellow;">VIC::Receiver</code></li>
                        <li><code style="color:yellow;">VIC::Grammar</code> and <code style="color:yellow;">VIC::Receiver</code> use base class
                        <code style="color:yellow;">Pegex::Base</code> which is just <code style="color:yellow;">Mo</code></li>
                    </ul>
                </section>
                <section>
                    <h2>Intermediate Code Generation</h2>
                    <ul>
                        <li>Generated appropriately by each callback as
                        needed</li>
                        <li>The AST stores intermediate code</li>
                        <li>In the <code style="color:yellow;">final</code> callback
                            <ul>
                                <li>Checks for <code style="color:yellow;">Main</code> block</li>
                                <li>Checks for correct chip features</li>
                                <li>Generates assembly code for the appropriate
                                chip</li>
                                <li>Chip features handled by the various
                                <code style="color:yellow;">VIC::PIC::*</code> classes</li>
                            </ul>
                        </li>
                    </ul>
                </section>
                <section>
                    <h2>Assembly Generation using Moo::Role</h2>
                    <ul>
                        <li>Chips are complex</li>
                        <li>Some chips are completely identical except for
                         certain features</li>
                        <li>User should not have to track chip features</li>
                        <li>Compiler has all details, so it can do that</li>
                    </ul>
                </section>
                <section>
                    <h2>... Assembly Generation ...</h2>
                    <ul>
                        <li>Each feature defined as a <code style="color:yellow;">Moo::Role</code></li>
                        <li>Examples: UART, PWM, I<sup>2</sup>C, SPI, GPIO</li>
                        <li>Allows:
                        <ul>
                            <li>separation of chip details into separate classes</li>
                            <li>separation of chip implementations into separate classes</li>
                            <li>special implementations based on chip internals</li>
                            <li>compiler to tell user that feature not supported</li> 
                            <li>compiler to list chip's features on commandline</li>
                        </ul>
                        </li>
                    </ul>
                </section>
                <section>
                    <h2>... Assembly Generation ...</h2>
                    <ul>
                        <li><code style="color:yellow;">Moo::Role</code> used like an interface in VIC&trade;</li>
                        <li><code style="color:yellow;">VIC::PIC::Roles::*</code> is a list of all different roles</li>
                        <li>Implementations of those roles separated into <code style="color:yellow;">VIC::PIC::Functions::*</code></li>
                        <li>A chip class defines:
                        <ul>
                            <li>Pin specifications as required by the role</li>
                            <li>Calls <code style="color:yellow;">with</code> on the names of the <code style="color:yellow;">VIC::PIC::Roles::*</code>
                            and <code style="color:yellow;">VIC::PIC::Functions::*</code></li>
                        </ul>
                        </li>
                    </ul>
                </section>
                <section>
                    <h2>... Usage ...</h2>
					<pre><code data-trim contenteditable style="font-size: 22px; margin-top: 20px;" class="perl">
package VIC::PIC::Roles::Timer;
{
    use Moo::Role;

    requires qw(timer_enable timer_disable timer timer_prescaler
    wdt_prescaler timer_pins);
}
                </code></pre>
                </section>
                <section>
                    <h2>... Usage ...</h2>
					<pre><code data-trim contenteditable style="font-size: 22px; margin-top: 20px;width:100%;"
                    class="stretch perl">
package VIC::PIC::Functions::Timer;
use Carp;
use Moo::Role;
sub timer_disable {
    my ($self, $tmr) = @_;
    return unless $self-&gt;doesroles(qw(Timer Chip));
    unless (exists $self-&gt;timer_pins-&gt;{$tmr}) {
        carp "$tmr is not a timer.";
        return;
    }
    unless (exists $self-&gt;registers-&gt;{OPTION_REG} and
        exists $self-&gt;registers-&gt;{INTCON}) {
        carp $self-&gt;pic-&gt;type,
        " does not have the register OPTION_REG/INTCON";
        return;
    }
    return &lt;&lt; "...";
\tbanksel INTCON
\tbcf INTCON, T0IE ;; disable only the timer bit
\tbanksel OPTION_REG
\tmovlw B'00001000'
\tmovwf OPTION_REG
\tbanksel $tmr
\tclrf $tmr
...
}
                    </code></pre>
                </section>
                <section>
                    <h2>... Usage ...</h2>
					<pre><code data-trim contenteditable style="font-size: 22px; margin-top: 20px;width:100%;" class="stretch perl">
package VIC::PIC::P12F683;
{
    use Moo;
    extends 'VIC::PIC::Base';
    # role CodeGen
    has type =&gt; (is =&gt; 'ro', default =&gt; 'p12f683');
    has include =&gt; (is =&gt; 'ro', default =&gt; 'p12f683.inc');
    # .... MORE RULE IMPLEMENTATIONS....

    my @rolenames = qw(CodeGen Operators Chip GPIO
                    ADC ISR Timer Operations CCP Comparator);
    my @roles = map (("VIC::PIC::Roles::$_",
                    "VIC::PIC::Functions::$_"),
                     @rolenames);
    with @roles;
}
                    </code></pre>
                </section>
                <section>
                    <h2>Integration With <code style="color:yellow;">gputils</code></h2>
                    <ul>
                        <li>Install <code style="color:yellow;">Alien::gputils</code></li>
                        <li>Install <code style="color:yellow;">gpsim</code></li>
                        <li>VIC&trade; just finds the executables and uses them</li>
                        <li>User need not manually use them unless they want to</li>
                    </ul>
                </section>
                <section>
                    <h2>Future Work</h2>
                    <ul>
                        <li>Add more chips</li>
                        <li>Implement missing features</li>
                        <li>Assembly code optimizations</li>
                        <li>Perfect simulations</li>
                        <li>Examples of applications in Robotics</li>
                    </ul>
                </section>
				<section>
					<h1>THE END</h1>
					<h3>BY Vikas N Kumar, <a href="http://selectiveintellect.com">Selective Intellect</a></h3>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
                loop: false, //true, // loop the presentation
                //autoSlide: 4000,
				transition: 'default', // default/cube/page/concave/zoom/linear/fade/none
				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
				]
			});

		</script>

	</body>
</html>
